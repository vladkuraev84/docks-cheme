(()=>{"use strict";const t="http://localhost:3033",e="form-widget-g",a="form-widget-g-files";class n{static deleteDuplicates(){const t=this.getForms();if(t.length>1)for(let e=1;e<t.length;e++)t[e].remove()}static getForm(){return this.getForms()[0]}static getForms(){const t=document.getElementsByTagName(e);if(!t||!t.length)throw new Error("WDFL: Not found any tag form-widget-g");return t}}class s{static get(t){const{projectId:e,page:a,path:n=""}=t.dataset;return{projectId:e,page:a,initContentPath:n,useApi:"useApi"in t.dataset,dev:"dev"in t.dataset}}static validate({projectId:t,page:e,useApi:a}){if(!e)throw new Error("WDFL: Empty param page key");if(a&&!t)throw new Error("WDFL: Empty attribute data-project-id")}}var o=function(t,e,a,n){return new(a||(a=Promise))((function(s,o){function i(t){try{c(n.next(t))}catch(t){o(t)}}function r(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(i,r)}c((n=n.apply(t,e||[])).next())}))};class i{static send(t,e){this.saveToStorage(`${this.storagePrefix}scheme`,t),this.saveToStorage(`${this.storagePrefix}locales`,e)}static saveToStorage(t,e){const a=JSON.stringify(e);localStorage.setItem(t,a)}}i.storagePrefix="WDFL:init:";class r{static getLocalUrl(t){return`${t}/form-widget-g.js`}static getFallbackUrl(){return`${t}/p/client/bundles/form-widget-g.js`}}class c{static isLoaded(){return!!document.getElementById(this.key)}static append(t){document.getElementById(a).append(t)}static remove(){document.getElementById(this.key).remove()}}c.key="main-bundle";class l{static inject(t,e){if(e)return;if(c.isLoaded())return;if(!t)return void this.injectDefaultBundle();const a=r.getLocalUrl(t),n=this.generateScript(a);c.append(n)}static generateScript(t){const e=document.createElement("script");return e.type="text/javascript",e.id=c.key,e.src=t,e.onerror=l.handleError,e}static injectDefaultBundle(){const t=r.getFallbackUrl(),e=this.generateScript(t);c.append(e),this.showWarn("")}static handleError(t){c.remove(),l.injectDefaultBundle(),l.showWarn(t.target.src)}static showWarn(t){console.warn(`WDFL: Can't find bundle in local path: ${t}, automatically used bundle from %FORMNAME% server`)}}class d{}class u{constructor(t=""){this.className=t}loadFileJS(t,e=null){if(!t)return;const a=document.createElement("script");a.type="text/javascript",a.src=t,a.className=this.getClassName(),e&&(a.onload=e),this.append(a)}loadFileCSS(t){if(!t)return;const e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.media="all",e.href=t,e.className=this.getClassName(),this.append(e)}append(t){document.getElementById(a).append(t)}getClassName(){return`module-${this.className}`}static initFilesContainer(){const t=document.createElement("div");t.id=a,document.body.append(t)}}class h{constructor(t){this.subPath="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.2.0/dist/",this.files={js:[this.subPath+"js/datepicker-full.min.js"],css:[this.subPath+"css/datepicker.min.css"]},this.localesPath=this.subPath+"js/locales/",this.module=t,this.DOMLoaderO=new u(t.name)}load(){this.files.js.forEach(((t,e)=>{0===e?this.DOMLoaderO.loadFileJS(t,(()=>{this.loadLocales()})):this.DOMLoaderO.loadFileJS(t)})),this.files.css.forEach((t=>this.DOMLoaderO.loadFileCSS(t)))}loadLocales(){this.getLocalesPath().forEach((t=>this.DOMLoaderO.loadFileJS(t)))}getLocalesPath(){var t,e;const a=(null===(e=null===(t=this.module.config)||void 0===t?void 0:t.locales)||void 0===e?void 0:e.relations)||{};return this.getAvailableLangs().map((t=>a[t]||t)).map((t=>this.generatePathToLocale(t)))}getAvailableLangs(){var t;const{scheme:e}=d;let a=(null===(t=e.config.localization)||void 0===t?void 0:t.availableLangs)||[];return a=a.filter((t=>"en"!==t)),a}generatePathToLocale(t){return this.localesPath+t+".min.js"}}class f{constructor(t){switch(t.name){case"datepicker":new h(t).load();break;case"menu":break;default:throw new Error(`ModuleLoader: Module ${t.name} not found`)}}}(class{static run(){return e=this,a=void 0,c=function*(){n.deleteDuplicates();const e=n.getForm(),{projectId:a,page:r,initContentPath:c,useApi:h,dev:m}=s.get(e);s.validate({projectId:a,page:r,useApi:h});const{scheme:p,locales:g}=yield class{static getStartedInfo({projectId:e,initContentPath:a,useApi:n}){return s=this,i=void 0,c=function*(){return n?class{static get(e){return a=this,n=void 0,o=function*(){const a=`${t}/api/v1/public/form/init?projectId=${e}`,n=yield fetch(a).then((t=>t.json()));if(!(n&&n.success&&n.data.scheme&&n.data.locales))throw new Error("WDFL: Bad response, to API request for get started info");return n.data},new((s=void 0)||(s=Promise))((function(t,e){function i(t){try{c(o.next(t))}catch(t){e(t)}}function r(t){try{c(o.throw(t))}catch(t){e(t)}}function c(e){var a;e.done?t(e.value):(a=e.value,a instanceof s?a:new s((function(t){t(a)}))).then(i,r)}c((o=o.apply(a,n||[])).next())}));var a,n,s,o}}.get(e):class{static get(t=""){return o(this,void 0,void 0,(function*(){const[e,a]=yield Promise.all([this.getData(`${t}/scheme.json`),this.getData(`${t}/locales.json`)]).catch((()=>{throw new Error("WDFL: not correct path in attr data-path or can't find scheme.json or locales.json or can't parse json format")}));return{scheme:e,locales:a}}))}static getData(t){return o(this,void 0,void 0,(function*(){return fetch(t).then((t=>t.json()))}))}}.get(a)},new((r=void 0)||(r=Promise))((function(t,e){function a(t){try{o(c.next(t))}catch(t){e(t)}}function n(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){var s;e.done?t(e.value):(s=e.value,s instanceof r?s:new r((function(t){t(s)}))).then(a,n)}o((c=c.apply(s,i||[])).next())}));var s,i,r,c}}.getStartedInfo({projectId:a,initContentPath:c,useApi:h});i.send(p,g),d.scheme=p,u.initFilesContainer(),class{static load(){const{scheme:t}=d;t&&t.config&&t.config.modules&&t.config.modules.forEach((t=>{t&&t.name&&!1!==t.enable&&new f(t)}))}}.load(),l.inject(c,m)},new((r=void 0)||(r=Promise))((function(t,n){function s(t){try{i(c.next(t))}catch(t){n(t)}}function o(t){try{i(c.throw(t))}catch(t){n(t)}}function i(e){var a;e.done?t(e.value):(a=e.value,a instanceof r?a:new r((function(t){t(a)}))).then(s,o)}i((c=c.apply(e,a||[])).next())}));var e,a,r,c}}).run().catch((t=>console.error(t)))})();